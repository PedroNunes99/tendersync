---------------------------- section ----------------------------
docs
---------------------------- document_id ----------------------------
649
---------------------------- title ----------------------------
REST API Users Guide
---------------------------- permalink ----------------------------
data-api
---------------------------- keywords ----------------------------
api activeresource active_resource rest
---------------------------- body ----------------------------
New Relic supports a RESTful API that can be used to create new accounts, list applications within a given account and enumerate the health indicators of each application. The API uses the XML response format. As a convenience, New Relic offers an ActiveResource wrapper API, but developers are welcome to work directly with the XML.

<a name="Authentication"></a>
## Authentication

New Relic supports a key based authentication mechanism. The key is the agent key associated with an account (supplied in the account creation email and available on the account agent overview page). This key should be passed as a request header with each request. All API calls described in this document require authentication. 

### Request Headers

<table>
<tr><th>Name</th>              <th>Type</th><th>Description</th></tr>
<tr><td>x-license-key</td><td>String</td><td>license key of account, used for authentication (required)</td></tr>
</table>

### ActiveResource authentication under Rails
When using the agent's ActiveResource wrapper, by default the license key from the config/newrelic.yml file will be used. Optionally an alternate key can be specified by setting the following static field:

    NewRelicApi.license_key = '<license key>'

<a name="ActiveResource_API"></a>
### ActiveResource API
The New Relic ActiveResource based API can be found in the `lib` directory of the New Relic Agent (version 2.8.0+).  The file is named `new_relic_api.rb`.  If you are using ActiveResource to access our API you can focus on the documentation and examples contained within that Ruby file. 

The remainder of this document will describe our XML API.

<a name="Account_Creation_API"></a>
## Account Creation API

### URL
    http://rpm.newrelic.com/accounts/create.xml
Method: POST
Restrictions: This API can only be called by New Relic Affiliates

### Authentication
Callers of this API should pass the license key information as
described above. The account associated with the given license key
must be an affiliate account or a 403 (Forbidden) error code will
be raised. Please contact New Relic customer support if your
account is part of our affiliate program and you encounter any
problems.

### Request Parameters

Parameter names are concatenated using brackets []. For example,
the full name of the account phone number parameter is
account[phone_number], and the user's first name parameter is
user[first_name].

<table>
<tr><th>Name</th>        <th>Type</th><th>Description</th></tr>
<tr><td>product_id</td><td>String</td><td>Product ID. Must match a product name in RPM (e.g. "Lite")</td></tr>
<tr><td><strong>account</strong></td></tr>
<tr><td>name</td>                    <td>String</td><td>Account name. Must be unique in New Relic database.</td></tr>
<tr><td>phone_number</td>  <td>String</td><td>Primary contact phone number (optional)</td></tr>
<tr><td>allow_rails_core</td><td>boolean {0|1}</td><td>If set, allow Rails Core Team to view account data (default is
false).</td></tr>
<tr><td>allow_api_access</td><td>boolean {0|1}</td><td>Allow API access to application data (default is false).
<strong>This must be set to "1" in order to access the summary metrics API for the account.</strong></td></tr>
<tr><td><strong>user</strong></td></tr>
<tr>
<td>email</td><td>string</td><td>Primary administrator's email address. This must be unique in the New Relic database. If an existing user record already exists, it will be linked to this account</td></tr>
<tr><td>password</td><td>String</td><td>Primary administrator's password (required). If a user record matching the email address already exists, this must match the existing password.</td></tr>
<tr><td>password_confirmation</td><td>String</td>
<td>Password confirmation (required only for new users, and
must match the password field)</td></tr>
<tr><td>first_name</td><td>String</td><td>Primary administrator's first name (optional, applies only to new users)</td></tr>
<tr><td>last_name</td><td>String</td><td>Primary administrator's last name (optional, applies only to new users)</td></tr>
<tr><td>terms_of_service</td><td>boolean {0|1}</td><td>Accept terms of service. Applies only to new users. Must be set to "1".</td></tr>
</table>

To view the New Relic Terms of Service, use this URL:
<code>http://rpm.newrelic.com/terms_of_service</code>

### Data returned

The data returned is in XML. Any errors reported during account creation will be returned in an XML document with a root ʻerrorsʼ element with an appropriate http error code.

Sample data returned upon successful account creation:

    <account>
      <allow-rails-core>false</allow-rails-core> 
      <id>23</id> 
      <license-key>fb41529f69458683f2038a8b3b2d4ed9ecc079c7</license-key> 
      <name>New Relic Customer</name> 
      <phone-number>415-555-1212</phone-number> 
      <status>active</status> 
      <primary-admin> 
        <email><a href="mailto:hank@newrelic.com">hank@newrelic.com</a></email> 
        <first-name>New Relic</first-name> 
        <last-name>Administrator</last-name> 
        <state>active</state> 
      </primary-admin> 
      <subscription> 
        <annual-renewal-on nil="true"/> 
        <expires-on nil="true"/> 
        <number-of-hosts nil="true"/> 
        <starts-on>2008-11-20</starts-on> 
        <state>free</state> 
        <product-name>Lite</product-name> 
      </subscription> 
    </account> 

The license key returned will be used by the application agent to report data for the account. It will be also used to access the application summary metrics as described in the next section.

### Possible Error Conditions
If the account name already exists in the NR database, this will
be returned in an errors tag and the error code will be set to 422
(unprocessable entity). Example:

    <errors>
      <error>Name has already been taken</error> 
    </errors> 

### Other Error Conditions

* Invalid License Key (500)
* Forbidden (403)

### ActiveResource Example

    account = NewRelicApi::Account.create(
       :product_id => 'Lite',
       :name => 'test account',
                :allow_api_access => true,
       :user => { :email => "<a href="mailto:user@company.com">user@company.com</a>",
                :password => "password",
                :password_confirmation => "password",
                :first_name => "John",
                :last_name => "Doe",
                :terms_of_service => '1' })

<a name="Account_Query_API"></a>
## Account Query API

<a name="View_Account"></a>
## View Account

**URL**
<code>http://rpm.newrelic.com/accounts.xml</code>

Method: GET
Restrictions: None

### Request Parameters
None

### Data Returned
Sample data:

    <accounts type="array">
      <account> 
        <allow-rails-core>false</allow-rails-core> 
        <id>1234</id> 
        <license-key>09230994882984787983774665</license-key> 
        <name>My Account</name> 
        <phone-number nil="true"></phone-number> 
        <primary-admin> 
          <email>me@mycompany.com</email> 
          <first-name>John</first-name> 
          <last-name>Doe</last-name> 
          <state>active</state> 
        </primary-admin> 
      </account> 
    </accounts> 

### Possible Error Conditions

* Invalid License Key (500)

<a name="View_applications"></a>
## View applications

<strong>URL</strong>
<code>http://rpm.newrelic.com/accounts/:account_id/applications.xml</code>

Replace :account_id with the account id. If using license key
authentication, this account id will be ignored (but some value
must still be given).

Method: GET
Restrictions: None

### Data Returned
Sample data:

    <?xml version="1.0" encoding="UTF-8"?>
    <applications type="array"> 
      <application> 
        <id type="integer">123</id> 
        <name>My Application</name> 
        <overview-url><a href="https://rpm.newrelic.com/browser/agent?account_id=1&agent=123%3C">https://rpm.newrelic.com/browser...</a>/overview-url> 
      </application> 
      <application> 
        <id type="integer">124</id> 
        <name>My Application2</name> 
        <overview-url><a href="https://rpm.newrelic.com/browser/agent?account_id=1&agent=124%3C">https://rpm.newrelic.com/browser...</a>/overview-url> 
      </application> 
    </applications> 

### Possible Error Conditions

* Invalid License Key (500)

<a name="View_application_thresholds"></a>
## View application threshold values (traffic light information)

<strong>URL</strong>
<code>http://rpm.newrelic.com/accounts/:account_id/applications/:app_id/threshold_values.xml</code>

Replace :account_id and :app_id with the account and application
ids.
Method: GET
Restrictions: This API should be called at most once per
minute

### Data Returned
Note: Application Busy data will only be returned to Gold
customers. Errors data will only be returned to Silver and Gold
customers.

Sample data:

    <?xml version="1.0" encoding="UTF-8"?>
    <threshold-values type="array"> 
      <threshold_value name="Apdex" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="0.96 [1.0]*" threshold_value="1" metric_value="0.96"/> 
      <threshold_value name="Application Busy" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="3%" threshold_value="1" metric_value="3"/> 
      <threshold_value name="CPU" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="52.86 %" threshold_value="1" metric_value="52.86"/> 
      <threshold_value name="Memory" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="261.42 MB" threshold_value="1" metric_value="261.42"/> 
      <threshold_value name="Errors" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="0.0 epm" threshold_value="1" metric_value="0.0"/> 
      <threshold_value name="Response Time" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="31 ms" threshold_value="1" metric_value="31"/> 
      <threshold_value name="Throughput" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="14028.6 cpm" threshold_value="1" metric_value="14028.6"/> 
      <threshold_value name="DB" begin_time="Fri Dec 12 01:22:00 +0000 2008" end_time="Fri Dec 12 01:27:00 +0000 2008" formatted_metric_value="46.82 %" threshold_value="1" metric_value="46.82"/> 
    </threshold-values> 

### Possible Error Conditions

* Invalid License Key (500)
* Unknown Application (404)

<a name="Application_Summary_Metrics_API"></a>
## Application Summary Metrics API
**URLs**
Fetch the threshold values (traffic light information) for all applications:
<code>http://rpm.newrelic.com/accounts.xml?include=application_health</code>

Method: GET
Restrictions: This API should be called at most once per minute

### Data Returned

Note: Application Busy data will only be returned to Gold customers. Errors data will only be returned to Silver and Gold customers.

Sample data:

    <accounts type="array">
      <account> 
        <id>1</id> 
        <name>New Relic Administration</name> 
        <applications type="array"> 
          <application> 
            <id type="integer">5</id> 
            <name>My Application</name> 
            <threshold-values type="array"> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="0.96 [1.0]*" name="Apdex" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="0.96"/> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="3%" name="Application Busy" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="3"/> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="2.59 %" name="CPU" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="2.59"/> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="151.62 MB" name="Memory" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="151.62"/> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="0.0 epm" name="Errors" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="0.0"/> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="947 ms" name="Response Time" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="947"/> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="2.4 cpm" name="Throughput" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="2.4"/> 
              <threshold_value begin_time="Fri Nov 21 20:03:00 +0000 2008" formatted_metric_value="0.52 %" name="DB" end_time="Fri Nov 21 20:08:00 +0000 2008" threshold_value="1" metric_value="0.52"/> 
            </threshold-values> 
          </application> 
        </applications> 
      </account> 
    </accounts> 

### Possible Error Conditions

* Invalid License Key (500)

<a name="Dashboard_HTML_fragment"></a>
## Dashboard HTML fragment

New Relic provides a HTML fragment of the <a href="https://rpm.newrelic.com/browser/agents">dashboard view</a> of RPM. The styles are included, and the images linked absolutely, which enables callers to embed the response directly in their applications. Authentication is through setting the appropriate license key header as outlined above, or through the regular login cookie. When using the regular login cookie, the logged-in user's default account's applications will be shown.

**URL**
HTML Fragment with all applications:
<code>http://rpm.newrelic.com/widgets/applications.html</code>


Method: GET
Restrictions: This API should be called at most once per minute

### Request Parameters

None.

### Data Returned

Note: Application Busy data will only be returned to Gold customers. Errors data will only be returned to Silver and Gold customers.

Sample data:

    <link href="http://rpm.newrelic.com/stylesheets/widgets/applications.css?1229134070" media="screen" rel="stylesheet" type="text/css" />
    <div id="newrelic_rpm_widget">
    <table class="proper agents">
      <thead>
        <tr>
          <th>Applications</th>
          <th>Apdex <small> </small></th>
          <th>Busy <small> </small></th>
          <th>CPU <small>by host</small></th>
          <th>Memory <small>by host</small></th>
          <th>Errors <small>per min</small></th>
          <th>Resp. Time <small>total</small></th>
          <th>Throughput <small>req/min</small></th>
          <th>DB <small>by host</small></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=24">RPM</a>
            <small>1 Host, 1 Instance
            </small>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/apdex?account_id=1&agent=24">
              <img alt="No Data" src="http://rpm.newrelic.com/images/grey_light.png?1223317647" /> NS [0.03]*
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/busy?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 3%
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 3.06 %
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 585.61 MB
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/accounts/1/agents/24/traced_errors">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 0.0 epm
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/controllers?account_id=1&agent=24">
              <img alt="Warning" src="http://rpm.newrelic.com/images/yellow_light.png?1223317647" /> 1253 ms
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/load_by_url?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 2.4 cpm
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/active_record?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 2.52 %
            </a>
          </td>
        </tr>
        <tr>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=27">RPM Local</a>
            <small>1 Host, 1 Instance
            </small>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/apdex?account_id=1&agent=27">
              <img alt="No Data" src="http://rpm.newrelic.com/images/grey_light.png?1223317647" /> NS [0.03]*
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/busy?account_id=1&agent=27">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 6%
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=27">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 3.06 %
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=27">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 585.61 MB
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/accounts/1/agents/27/traced_errors">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 0.0 epm
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/controllers?account_id=1&agent=27">
              <img alt="Warning" src="http://rpm.newrelic.com/images/yellow_light.png?1223317647" /> 1253 ms
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/load_by_url?account_id=1&agent=27">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 2.4 cpm
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/active_record?account_id=1&agent=27">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 2.52 %
            </a>
          </td>
        </tr>
      </tbody>
    </table>
    </div>

### Possible Error Conditions

* Invalid License Key (500)

<strong>URL</strong>
HTML Fragment with only one application:
<code>http://rpm.newrelic.com/widgets/applications/:id.html</code>

Replace :id with application id.
Method: GET
Restrictions: This API should be called at most once per minute

### Request Parameters
None.

### Data Returned
Notes: Application Busy data will only be returned to Gold customers. Errors data will only be returned to Silver and Gold customers.

Sample data:

    <link href="http://rpm.newrelic.com/stylesheets/widgets/applications.css?1229134070" media="screen" rel="stylesheet" type="text/css" />
    <div id="newrelic_rpm_widget">
    <table class="proper agents">
      <thead>
        <tr>
          <th>Applications</th>
          <th>Apdex <small> </small></th>
          <th>Busy <small> </small></th>
          <th>CPU <small>by host</small></th>
          <th>Memory <small>by host</small></th>
          <th>Errors <small>per min</small></th>
          <th>Resp. Time <small>total</small></th>
          <th>Throughput <small>req/min</small></th>
          <th>DB <small>by host</small></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=24">RPM</a>
            <small>1 Host, 1 Instance
            </small>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/apdex?account_id=1&agent=24">
              <img alt="No Data" src="http://rpm.newrelic.com/images/grey_light.png?1223317647" /> NS [0.03]*
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/busy?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 3%
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 7.41 %
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/agent?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 604.84 MB
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/accounts/1/agents/24/traced_errors">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 0.0 epm
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/controllers?account_id=1&agent=24">
              <img alt="Warning" src="http://rpm.newrelic.com/images/yellow_light.png?1223317647" /> 1405 ms
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/load_by_url?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 5.0 cpm
            </a>
          </td>
          <td>
            <a href="http://rpm.newrelic.com/browser/active_record?account_id=1&agent=24">
              <img alt="Normal" src="http://rpm.newrelic.com/images/green_light.png?1223317647" /> 6.37 %
            </a>
          </td>
        </tr>
      </tbody>
    </table>
    </div>

### Possible Error Conditions

* Invalid License Key (500)
* Unknown Application (404)
